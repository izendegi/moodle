define("tiny_snippet/template_presets_amd",["jquery","core/log"],(function($,log){return log.debug("Tiny Snippet Presets initialising"),{presetdata:!1,dataitems:["name","key","instructions","defaults","body","version"],fetchcontrols:function(templateindex){var controls={};return controls.name=document.getElementById("id_s_tiny_snippet_snippetname_"+templateindex),controls.key=document.getElementById("id_s_tiny_snippet_snippetkey_"+templateindex),controls.instructions=document.getElementById("id_s_tiny_snippet_snippetinstructions_"+templateindex),controls.defaults=document.getElementById("id_s_tiny_snippet_defaults_"+templateindex),controls.body=document.getElementById("id_s_tiny_snippet_snippet_"+templateindex),controls.version=document.getElementById("id_s_tiny_snippet_snippetversion_"+templateindex),controls},fetchjsonbundle:function(templateindex,controls){var bundle={};$.each(this.dataitems,(function(index,item){bundle[item]=controls[item].value}));var jsonbundle=JSON.stringify(bundle);return jsonbundle},exportbundle:function(templateindex){var controls=this.fetchcontrols(templateindex);if(""!=controls.key.value){var jsonbundle=this.fetchjsonbundle(templateindex,controls),pom=document.createElement("a");if(pom.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(jsonbundle)),pom.setAttribute("download",controls.key.value+".txt"),document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!0),pom.dispatchEvent(event)}else pom.click()}},populateform:function(templateindex,presetindex,presetdata){var controls=this.fetchcontrols(templateindex);(presetindex||presetdata)&&(0==presetindex&&presetdata||(presetdata=this.presetdata),$.each(this.dataitems,(function(index,item){if(presetdata[presetindex].hasOwnProperty(item))controls[item].value=presetdata[presetindex][item];else if("anycheckboxfield"===item)controls[item].value=0;else controls[item].value=""})))},dopopulate:function(templateindex,templatedata){this.populateform(templateindex,0,new Array(templatedata))},init:function(opts){if(!this.presetdata){var controlid="#id_s_tiny_snippet_presetdata_"+opts.templateindex,presetcontrol=$(controlid).get(0);this.presetdata=JSON.parse(presetcontrol.value),$(controlid).remove()}var amdpresets=this;$("select[name='tiny_snippet/presets']").change((function(){amdpresets.populateform(opts.templateindex,$(this).val())}));var ddsquareid="#id_s_tiny_snippet_dragdropsquare_"+opts.templateindex;$(ddsquareid).on("click",(function(){amdpresets.exportbundle(opts.templateindex)})),$(ddsquareid).on("dragover",(function(event){event.preventDefault(),event.stopPropagation(),$(this).addClass("tiny_snippet_dragging")})),$(ddsquareid).on("dragleave",(function(event){event.preventDefault(),event.stopPropagation(),$(this).removeClass("tiny_snippet_dragging")})),$(ddsquareid).on("drop",(function(event){event.preventDefault();var files=event.originalEvent.dataTransfer.files;if(files.length){var f=files[0];if(f){var r=new FileReader;r.onload=function(e){var contents=e.target.result,templatedata=JSON.parse(contents);templatedata.key&&amdpresets.dopopulate(opts.templateindex,templatedata)},r.readAsText(f)}else alert("Failed to load file")}$(this).removeClass("tiny_snippet_dragging")}))}}}));

//# sourceMappingURL=template_presets_amd.min.js.map