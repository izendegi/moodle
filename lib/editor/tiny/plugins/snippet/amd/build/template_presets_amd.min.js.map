{"version":3,"file":"template_presets_amd.min.js","sources":["../src/template_presets_amd.js"],"sourcesContent":["/* jshint ignore:start */\ndefine(['jquery','core/log'], function($, log) {\n\n  \"use strict\"; // jshint ;_;\n\n  log.debug('Tiny Snippet Presets initialising');\n\n  return {\n\n\t  presetdata: false,\n\t  \n\t  dataitems: ['name','key', 'instructions','defaults', 'body','version'],\n\n\t  fetchcontrols: function(templateindex) {\n\t  \t  var controls = {};\n          controls.name = document.getElementById('id_s_tiny_snippet_snippetname_' + templateindex);\n\t\t  controls.key = document.getElementById('id_s_tiny_snippet_snippetkey_' + templateindex);\n\t\t  controls.instructions = document.getElementById('id_s_tiny_snippet_snippetinstructions_' + templateindex);\n\t\t  controls.defaults = document.getElementById('id_s_tiny_snippet_defaults_' + templateindex);\n\t\t  controls.body = document.getElementById('id_s_tiny_snippet_snippet_' + templateindex);\n\t\t  controls.version = document.getElementById('id_s_tiny_snippet_snippetversion_' + templateindex);\n\t\t  return controls;\n\t  },\n\t  \n\t  fetchjsonbundle: function(templateindex, controls){\n\t\t\tvar bundle={};\n\t\t\t $.each(this.dataitems,\n\t\t\t  function (index, item) {\n\t\t\t\t  bundle[item] =controls[item].value;\n\t\t\t  }\n\t\t    );\n\t\t    var jsonbundle = JSON.stringify(bundle);\n\t\t    return jsonbundle;\n    \t\twindow.open(\"data:text/json;charset=utf-8,\" + encodeURIComponent(jsonbundle));\n\t  },\n\t  \n\t  exportbundle: function(templateindex){\n\t\t\tvar controls = this.fetchcontrols(templateindex);\n\t\t\tif(controls.key.value==''){return;}\n\t\t\tvar jsonbundle = this.fetchjsonbundle(templateindex,controls);\n\t\t\t\n\t\t\tvar pom = document.createElement('a');\n\t\t\tpom.setAttribute('href', \"data:text/json;charset=utf-8,\" + encodeURIComponent(jsonbundle));\n\t\t\tpom.setAttribute('download', controls['key'].value + '.txt');\n\n\t\t\tif (document.createEvent) {\n\t\t\t\tvar event = document.createEvent('MouseEvents');\n\t\t\t\tevent.initEvent('click', true, true);\n\t\t\t\tpom.dispatchEvent(event);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpom.click();\n\t\t\t}\n\t  },\n\n\t  populateform: function (templateindex, presetindex, presetdata) {\n\t\t  //get all our html controls\n\t\t  var controls = this.fetchcontrols(templateindex);\n\n\t\t  //what a rip off there was no selection!!!\n\t\t  if(!presetindex && !presetdata){return;}\n\t\t  if(presetindex==0 && presetdata){\n\t\t  \t//this is good, we have something from dopopulate\n\t\t  }else{\n\t\t   //this is a normal selection\n\t\t  \tpresetdata  =this.presetdata;\n\t\t  }\n\t\t  \n\t\t  $.each(this.dataitems,\n\t\t\t  function (index, item) {\n\t\t\t\t  // log.debug(item + ':' + presetindex + ':' + presetdata[presetindex][item]);\n\t\t\t\t  //first check we have a data item for this control(old bundles don7 have instructions etc)\n\t\t\t\t  //then set the data\n\t\t\t\t  if (presetdata[presetindex].hasOwnProperty(item)) {\n\t\t\t\t   controls[item].value = presetdata[presetindex][item];\n\t\t\t      }else{\n\t\t\t      \tswitch(item){\n\t\t\t      \t\tcase 'anycheckboxfield':\n\t\t\t      \t\t\tcontrols[item].value =0;\n\t\t\t      \t\t\tbreak;\n\t\t\t      \t\tdefault:\n\t\t\t      \t\t\tcontrols[item].value ='';\n\t\t\t      \t}\n\t\t\t      }\n\t\t\t  }\n\t\t  );\n\n\t  },\n\n\t  dopopulate: function(templateindex, templatedata){\n\t\tthis.populateform(templateindex,0,new Array(templatedata));\n\t  },\n\t\t\n\t\t// load all snippet stuff and stash all our variables\n\t\tinit: function(opts) {\n\t\t\tif (!this.presetdata) {\n\t\t\t\tvar controlid='#id_s_tiny_snippet_presetdata_' + opts['templateindex'];\n\t\t\t\tvar presetcontrol=$(controlid).get(0);\n\t\t\t\tthis.presetdata = JSON.parse(presetcontrol.value);\n\t\t\t\t$(controlid).remove();\n\t\t\t}\n\n\t\t\tvar amdpresets = this;\n\t\t\t//handle the select box change event\n\t\t\t$(\"select[name='tiny_snippet/presets']\").change(function(){\n\t\t\t\tamdpresets.populateform(opts['templateindex'],$(this).val());\n\t\t\t});\n\t\t\t\n\t\t\t//drag drop square events\n\t\t\tvar ddsquareid='#id_s_tiny_snippet_dragdropsquare_' + opts['templateindex'];\n\t\t\t\n\t\t\t//export the current bundle\n\t\t\t$(ddsquareid).on(\"click\", function() {\n\t\t\t\tamdpresets.exportbundle(opts['templateindex']);\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\t//handle the drop event. First cancel dragevents which prevent drop firing\n\t\t\t$(ddsquareid).on(\"dragover\", function(event) {\n\t\t\t\tevent.preventDefault();  \n\t\t\t\tevent.stopPropagation();\n\t\t\t\t$(this).addClass('tiny_snippet_dragging');\n\t\t\t});\n\t\t\t\n\t\t\t$(ddsquareid).on(\"dragleave\", function(event) {\n\t\t\t\tevent.preventDefault();  \n\t\t\t\tevent.stopPropagation();\n\t\t\t\t$(this).removeClass('tiny_snippet_dragging');\n\t\t\t});\n\t\t\t\n\t\t\t$(ddsquareid).on('drop', function(event) {\n\n \t\t\t\t//stop the browser from opening the file\n \t\t\t\tevent.preventDefault();\n\t\t\t\t //Now we need to get the files that were dropped\n\t\t\t\t //The normal method would be to use event.dataTransfer.files\n\t\t\t\t //but as jquery creates its own event object you ave to access \n\t\t\t\t //the browser even through originalEvent.  which looks like this\n\t\t\t\t var files = event.originalEvent.dataTransfer.files;\n\t\t\t\t \n\t\t\t\t //if we have files, read and process them\n\t\t\t\t if(files.length){\n\t\t\t\t \tvar f = files[0];\n\t\t\t\t \tif (f) {\n\t\t\t\t\t  var r = new FileReader();\n\t\t\t\t\t  r.onload = function(e) { \n\t\t\t\t\t\t  var contents = e.target.result;\n\t\t\t\t\t\t  var templatedata = JSON.parse(contents);\n\t\t\t\t\t\t  if(templatedata.key){\n\t\t\t\t\t\t  \tamdpresets.dopopulate(opts['templateindex'],templatedata);\n\t\t\t\t\t\t  }\n\t\t\t\t\t  };\n\t\t\t\t\t  r.readAsText(f);\n\t\t\t\t\t} else { \n\t\t\t\t\t  alert(\"Failed to load file\");\n\t\t\t\t\t}//end of if f\n\t\t\t\t}//end of if files\n\t\t\t\t$(this).removeClass('tiny_snippet_dragging');\n\t\t\t});\n\t\t}//end of function\n\t};\n});\n/* jshint ignore:end */"],"names":["define","$","log","debug","presetdata","dataitems","fetchcontrols","templateindex","controls","name","document","getElementById","key","instructions","defaults","body","version","fetchjsonbundle","bundle","each","this","index","item","value","jsonbundle","JSON","stringify","exportbundle","pom","createElement","setAttribute","encodeURIComponent","createEvent","event","initEvent","dispatchEvent","click","populateform","presetindex","hasOwnProperty","dopopulate","templatedata","Array","init","opts","controlid","presetcontrol","get","parse","remove","amdpresets","change","val","ddsquareid","on","preventDefault","stopPropagation","addClass","removeClass","files","originalEvent","dataTransfer","length","f","r","FileReader","onload","e","contents","target","result","readAsText","alert"],"mappings":"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"}