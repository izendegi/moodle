define("tiny_codepro/preferences",["exports","./options","./remotesrv"],(function(_exports,_options,_remotesrv){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getPreferencesSrv=_exports.PreferencesService=void 0;const defaultPrefs={theme:"light",wrap:!0,fs:!1,fontsize:11,minimap:!0,view:void 0};class PreferencesService{static SAVE_DELAY=1e3;constructor(editor){this.editor=editor,this.preferences=this._loadPrefs(),this._lastSavedJson=JSON.stringify(this.preferences),this._saveTimeout=null,this._dirty=!1}_loadPrefs(){const remotePrefsJson=(0,_options.getUserPrefs)(this.editor),localPrefsJson=localStorage.getItem("tiny-codepro");let storedParsed={};try{if(remotePrefsJson)storedParsed=JSON.parse(remotePrefsJson);else if(localPrefsJson){const localPrefs=JSON.parse(localPrefsJson);(0,_remotesrv.getRemoteService)().saveUserPref(localPrefsJson),storedParsed=localPrefs}}catch(ex){console.error("Cannot parse JSON user preferences",ex)}return{...defaultPrefs,...storedParsed}}get(key,def){return this.preferences[key]??def}set(key,value){let save=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._dirty=this._dirty||this.preferences[key]!==value,this.preferences[key]=value,save&&this._dirty&&this._scheduleSave()}_scheduleSave(){this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout((()=>this._save()),PreferencesService.SAVE_DELAY)}_save(){let prefs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.preferences;this._saveTimeout&&clearTimeout(this._saveTimeout);const json=JSON.stringify(prefs);json!==this._lastSavedJson&&(this._lastSavedJson=json,localStorage.setItem("tiny-codepro",json),this._dirty=!1,(0,_remotesrv.getRemoteService)().saveUserPref(json))}flush(){this._dirty&&(this._save(),this._dirty=!1)}all(){return{...this.preferences}}}_exports.PreferencesService=PreferencesService;const instances=new Map;_exports.getPreferencesSrv=editor=>{if(!editor)throw new Error("PreferencesService requires an editor instance");return instances.has(editor.id)||instances.set(editor.id,new PreferencesService(editor)),instances.get(editor.id)}}));

//# sourceMappingURL=preferences.min.js.map