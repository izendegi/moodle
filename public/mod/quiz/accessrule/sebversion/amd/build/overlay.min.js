define("quizaccess_sebversion/overlay",["exports","core/str"],(function(_exports,String){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,String=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Script to show a modal overlay in case of outdated versions of the
   * Safe Exam Browser.
   *
   * @module     quizaccess_sebversion/overlay
   * @copyright  2025, Philipp Imhof
   * @author     Philipp Imhof
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(String);const DEFAULT_MESSAGES={update:"Please update your Safe Exam Browser in order to attempt this quiz. You need at least version ",invalid:"The version of your Safe Exam Browser could not be determined. Please download the most recent official version and try again"},init=async(minVersionWin,minVersionMac,behat)=>{var _window$SafeExamBrows,_window$SafeExamBrows2;if(testisVersionAtLeast(),behat){const simulatedVersion=localStorage.getItem("quizaccess_sebversion_versionString");"no SEB"!==simulatedVersion&&(window.SafeExamBrowser={version:simulatedVersion}),testisVersionAtLeast()}const versionString=null!==(_window$SafeExamBrows=null===(_window$SafeExamBrows2=window.SafeExamBrowser)||void 0===_window$SafeExamBrows2?void 0:_window$SafeExamBrows2.version)&&void 0!==_window$SafeExamBrows?_window$SafeExamBrows:"";let overlayNeeded=!0,targetVersion="";versionString.includes("macOS")||versionString.includes("iOS")?(overlayNeeded=!checkMacVersion(versionString,minVersionMac),targetVersion=minVersionMac):versionString.includes("Windows")?(overlayNeeded=!checkWinVersion(versionString,minVersionWin),targetVersion=minVersionWin):overlayNeeded=!0,overlayNeeded&&await addOverlay(targetVersion)};_exports.init=init;const checkMacVersion=(versionString,minVersion)=>{const parts=versionString.split("_");return 5===parts.length&&isVersionAtLeast(parts[2],minVersion)},checkWinVersion=(versionString,minVersion)=>{const parts=versionString.split("_");return 3===parts.length&&isVersionAtLeast(parts[2],minVersion)},isVersionAtLeast=(givenVersion,minVersion)=>{var _givenParts$,_expectedParts$;const givenParts=givenVersion.split("."),expectedParts=minVersion.split(".");return parseInt(givenParts[0])>parseInt(expectedParts[0])||!(parseInt(givenParts[0])<parseInt(expectedParts[0]))&&(parseInt(givenParts[1])>parseInt(expectedParts[1])||!(parseInt(givenParts[1])<parseInt(expectedParts[1]))&&!(parseInt(null!==(_givenParts$=givenParts[2])&&void 0!==_givenParts$?_givenParts$:"0")<parseInt(null!==(_expectedParts$=expectedParts[2])&&void 0!==_expectedParts$?_expectedParts$:"0")))},addOverlay=async targetVersion=>{const variant=""===targetVersion?"invalid":"update";let message="";try{message=await String.get_string("overlay_text_".concat(variant),"quizaccess_sebversion",{version:targetVersion})}catch(err){window.console.error(err),message=DEFAULT_MESSAGES[variant]+targetVersion+"."}const overlay=document.createElement("div");overlay.classList.add("quizaccess_sebversion_overlay"),overlay.setAttribute("role","alertdialog"),overlay.setAttribute("aria-modal","true"),overlay.tabIndex=0,overlay.textContent=message,document.querySelector("body").appendChild(overlay),overlay.focus(),document.addEventListener("focus",(e=>{overlay.contains(e.target)||(e.stopPropagation(),e.preventDefault(),overlay.focus())}),!0);const events=["keydown","keyup","keypress","input","mousedown","mouseup","click","dblclick","contextmenu","pointerdown","pointerup","touchstart","touchend"],blocker=e=>{e.stopPropagation(),e.preventDefault()};for(const e of events)document.addEventListener(e,blocker,!0)},testisVersionAtLeast=()=>{const cases=[[!0,["1.2.3","1.2.3"]],[!0,["2.0.0","1.9.9"]],[!0,["2.0","2.0.0"]],[!0,["2.0","2.0"]],[!0,["2.0","1.9.9"]],[!1,["1.0.0","2.0.0"]],[!0,["1.5.0","1.4.9"]],[!1,["1.3.0","1.4.0"]],[!0,["1.2.5","1.2.3"]],[!1,["1.2.1","1.2.3"]],[!0,["1.2","1.2.0"]],[!1,["1.2","1.2.1"]],[!0,["1.2.1","1.2"]],[!0,["1.2.0","1.2"]],[!0,["10.12.3","9.99.99"]],[!1,["10.1.3","10.10.0"]]],info=document.createElement("p");info.textContent="quizaccess_sebversion unit tests successful";for(let c of cases){isVersionAtLeast(c[1][0],c[1][1])!==c[0]&&(info.textContent="quizaccess_sebversion unit test failed",window.console.error("failed unit test:",c))}document.body.append(info)};var _default={init:init};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=overlay.min.js.map