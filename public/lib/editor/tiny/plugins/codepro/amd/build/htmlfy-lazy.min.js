define("tiny_codepro/htmlfy-lazy",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;const CONFIG={content_wrap:0,ignore:[],ignore_with:"!i-£___£%_",strict:!1,tab_size:2,tag_wrap:0,trim:[]},VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],state={checked_html:!1,config:{...CONFIG},ignored:!1,constants:{CONTENT_IGNORE_PLACEHOLDER:`${CONFIG.ignore_with}_`,SELF_CLOSING_PLACEHOLDER:`${CONFIG.ignore_with}/_>`,ATTRIBUTE_IGNORE_PLACEHOLDER:`${CONFIG.ignore_with}=_`}},getState=()=>state,setState=new_state=>Object.assign(state,new_state),isHtml=content=>(setState({checked_html:!0}),/<(?:[A-Za-z]+[A-Za-z0-9]*)(?:\s+.*?)*?\/{0,1}>/.test(content)||/<(?<Element>(?:[A-Za-z]+[A-Za-z0-9]*:)?(?:[A-Za-z]+[A-Za-z0-9]*))(?:\s+.*?)*?>(?:.|\n)*?<\/{1}\k<Element>>/.test(content)||/<(?<Element>(?:[a-z][a-z0-9._]*:)?[a-z][a-z0-9._]*-[a-z0-9._-]+)(?:\s+.*?)*?>(?:.|\n)*?<\/{1}\k<Element>>/.test(content)),mergeObjects=(current,updates)=>{if(!current||!updates)throw new Error("Both 'current' and 'updates' must be passed-in to mergeObjects()");let merged;if(Array.isArray(current))merged=structuredClone(current).concat(updates);else if("object"==typeof current){merged={...current};for(let key of Object.keys(updates))"object"!=typeof updates[key]?merged[key]=updates[key]:merged[key]=mergeObjects(merged[key]||{},updates[key])}return merged},validateConfig=config=>{var _config$ignore,_config$trim;if("object"!=typeof config)throw new Error("Config must be an object.");const default_config={...CONFIG};if(!(Object.hasOwn(config,"content_wrap")||Object.hasOwn(config,"ignore")||Object.hasOwn(config,"ignore_with")||Object.hasOwn(config,"strict")||Object.hasOwn(config,"tab_size")||Object.hasOwn(config,"tag_wrap")||Object.hasOwn(config,"trim")))return setState({config:default_config}),default_config;let tab_size=config.tab_size;if(tab_size){if("number"!=typeof tab_size)throw new Error(`tab_size must be a number, not ${typeof config.tab_size}.`);if(!Number.isSafeInteger(tab_size))throw new Error(`Tab size ${tab_size} is not safe. See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isSafeInteger for more info.`);if(tab_size=Math.floor(tab_size),tab_size<1||tab_size>16)throw new Error("Tab size out of range. Expecting 1 to 16.");config.tab_size=tab_size}if(Object.hasOwn(config,"content_wrap")&&"number"!=typeof config.content_wrap)throw new Error(`content_wrap config must be a number, not ${typeof config.content_wrap}.`);if(Object.hasOwn(config,"ignore")&&(!Array.isArray(config.ignore)||null===(_config$ignore=config.ignore)||void 0===_config$ignore||!_config$ignore.every((e=>"string"==typeof e))))throw new Error("Ignore config must be an array of strings.");if(Object.hasOwn(config,"ignore_with")){if("string"!=typeof config.ignore_with)throw new Error(`ignore_with must be a string, not ${typeof config.ignore_with}.`);if(config.ignore_with.startsWith("_"))throw new Error("ignore_with cannot start with an underscore.")}if(Object.hasOwn(config,"strict")&&"boolean"!=typeof config.strict)throw new Error(`Strict config must be a boolean, not ${typeof config.strict}.`);if(Object.hasOwn(config,"tag_wrap")&&"number"!=typeof config.tag_wrap)throw new Error(`tag_wrap config must be a number, not ${typeof config.tag_wrap}.`);if(Object.hasOwn(config,"trim")&&(!Array.isArray(config.trim)||null===(_config$trim=config.trim)||void 0===_config$trim||!_config$trim.every((e=>"string"==typeof e))))throw new Error("Trim config must be an array of strings.");return((default_config,config)=>{const validated_config=mergeObjects(default_config,config);return setState({config:validated_config,constants:{CONTENT_IGNORE_PLACEHOLDER:`${validated_config.ignore_with}_`,SELF_CLOSING_PLACEHOLDER:`${validated_config.ignore_with}/_>`,ATTRIBUTE_IGNORE_PLACEHOLDER:`${validated_config.ignore_with}=_`}}),validated_config})(default_config,config)},wordWrap=(text,width,indent)=>{const words=text.trim().split(/\s+/);if(0===words.length||1===words.length&&""===words[0])return"";const lines=[];let current_line="";const padding_string=indent;words.forEach((word=>{if(""===word)return;if(word.length>=width)return""!==current_line&&lines.push(0===lines.length?indent+current_line:padding_string+current_line),lines.push(0===lines.length?indent+word:padding_string+word),void(current_line="");const test_line=""===current_line?word:current_line+" "+word;test_line.length<=width?current_line=test_line:(""!==current_line&&lines.push(0===lines.length?indent+current_line:padding_string+current_line),current_line=word)})),""!==current_line&&lines.push(0===lines.length?indent+current_line:padding_string+current_line);return(html=>{const{constants:constants}=getState();return html.replace(/\n/g,constants.CONTENT_IGNORE_PLACEHOLDER+"nl!").replace(/\r/g,constants.CONTENT_IGNORE_PLACEHOLDER+"cr!").replace(/\s/g,constants.CONTENT_IGNORE_PLACEHOLDER+"ws!")})(lines.join("\n"))};function extractIgnoredBlocks(html){setState({ignored:!0});const config=getState().config;let current_html=html;const extracted_blocks=new Map;let marker_id=0;for(const tag of config.ignore){const safe_tag_name=tag.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),regex=new RegExp(`(<\\s*${safe_tag_name}[^>]*>)(.*?)(<\\s*/\\s*${safe_tag_name}\\s*>)`,"gs");let match;const replacements=[];for(;null!==(match=regex.exec(current_html));){const marker=`___HTMLFY_SPECIAL_IGNORE_MARKER_${marker_id++}___`;extracted_blocks.set(marker,match[2]),replacements.push({start:match.index+match[1].length,end:match.index+match[1].length+match[2].length,marker:marker})}for(let i=replacements.length-1;i>=0;i--){const rep=replacements[i];current_html=current_html.substring(0,rep.start)+rep.marker+current_html.substring(rep.end)}}return{html_with_markers:current_html,extracted_map:extracted_blocks}}function reinsertIgnoredBlocks(html_with_markers,extracted_map){setState({ignored:!1});let final_html=html_with_markers;for(const[marker,original_block]of extracted_map)final_html=final_html.split(marker).join(original_block);return final_html}const void_element_regex=new RegExp(`<(${VOID_ELEMENTS.join("|")})(?:\\s(?:[^/>]|/(?!>))*)*>`,"g");let ignore_map$1;const convert={line:[]};let ignore_map;const process=()=>{const{config:config,constants:constants}=getState(),step=" ".repeat(config.tab_size),tag_wrap=config.tag_wrap,content_wrap=config.content_wrap,strict=config.strict;let indents="";const output_lines=[],tag_regex=/<[A-Za-z]+\b[^>]*(?:.|\n)*?\/?>/g,attribute_regex=/\s{1}[A-Za-z-]+(?:=".*?")?/g;convert.line.forEach(((source,index)=>{let current_line_value=source.value;const is_ignored_content=current_line_value.startsWith("___HTMLFY_SPECIAL_IGNORE_MARKER_");let subtrahend=0;const prev_line_data=convert.line[index-1],prev_line_value=(null==prev_line_data?void 0:prev_line_data.value)??"";indents+="0",0===index&&subtrahend++,current_line_value.trim().startsWith("</")&&subtrahend++,prev_line_value.trim().startsWith("<!doctype")&&subtrahend++,prev_line_value.trim().startsWith("\x3c!--")&&subtrahend++,(prev_line_value.trim().endsWith("/>")||prev_line_value.trim().endsWith(constants.SELF_CLOSING_PLACEHOLDER))&&subtrahend++,prev_line_value.trim().startsWith("</")&&subtrahend++,"text"===(null==prev_line_data?void 0:prev_line_data.type)&&subtrahend++;const current_indent_level=Math.max(0,indents.length-subtrahend);if(indents=indents.substring(0,current_indent_level),"text"===source.type&&/^[!,;\.]/.test(current_line_value)){if(1===current_line_value.length)return void(output_lines[output_lines.length-1]=output_lines.at(-1)+current_line_value);if(output_lines[output_lines.length-1]=output_lines.at(-1)+current_line_value.charAt(0),current_line_value=current_line_value.slice(1).trim(),0===current_line_value.length)return}const padding=step.repeat(current_indent_level);if(is_ignored_content)output_lines.push(current_line_value);else{if(strict&&current_line_value.trim().startsWith("\x3c!--"))return;let result=current_line_value;if(result=function(html){const{constants:constants}=getState();return html.replace(constants.SELF_CLOSING_PLACEHOLDER,">")}(result),"text"===source.type&&content_wrap>0&&result.length>=content_wrap)result=wordWrap(result,content_wrap,padding);else if(tag_wrap>0&&result.length>tag_wrap&&tag_regex.test(result)){tag_regex.lastIndex=0,attribute_regex.lastIndex=0;const tag_parts=result.split(attribute_regex).filter(Boolean);if(tag_parts.length>=2){var _tag_parts$at;const attributes=result.matchAll(attribute_regex),inner_padding=padding+step;let wrapped_tag=padding+tag_parts[0]+"\n";for(const a of attributes){wrapped_tag+=inner_padding+a[0].trim()+"\n"}const tag_name_match=tag_parts[0].match(/<([A-Za-z_:-]+)/),tag_name=tag_name_match?tag_name_match[1]:"",is_self_closing=(null===(_tag_parts$at=tag_parts.at(-1))||void 0===_tag_parts$at?void 0:_tag_parts$at.endsWith("/>"))&&VOID_ELEMENTS.includes(tag_name),closing_part=tag_parts[1].trim();wrapped_tag+=padding+(strict&&is_self_closing?" ":"")+closing_part,result=wrapped_tag}else result=padding+result}else result=padding+result;output_lines.push(result)}}));let final_html=output_lines.join("\n");return tag_wrap>0&&(final_html=(html=>{const{constants:constants}=getState();return html.replace(/<[\w:\-]+([^>]*[^\/])>/g,((match,capture)=>match.replace(capture,(match=>match.replace(/\n/g,constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"nl!").replace(/\r/g,constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"cr!").replace(/\s/g,constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"ws!")))))})(final_html)),content_wrap>0&&new RegExp(`/\\n[ ]*[^\\n]*${constants.CONTENT_IGNORE_PLACEHOLDER}[^\\n]*\\n/`).test(final_html)&&(final_html=(html=>{const{constants:constants}=getState();return html.replace(/\s*<([a-zA-Z0-9:-]+)[^>]*>\n\s*<\/\1>(?=\n[ ]*[^\n]*__!i-£___£%__[^\n]*\n)(\n[ ]*\S[^\n]*\n)|<([a-zA-Z0-9:-]+)[^>]*>(?=\n[ ]*[^\n]*__!i-£___£%__[^\n]*\n)(\n[ ]*\S[^\n]*\n\s*)<\/\3>/g,((match,p1,p2,p3,p4)=>{const text_to_protect=p2||p4;if(!text_to_protect)return match;const protected_text=text_to_protect.replace(/\n/g,constants.CONTENT_IGNORE_PLACEHOLDER+"nl!").replace(/\r/g,constants.CONTENT_IGNORE_PLACEHOLDER+"cr!").replace(/\s/g,constants.CONTENT_IGNORE_PLACEHOLDER+"ws!");return match.replace(text_to_protect,protected_text)}))})(final_html)),final_html=final_html.replace(/<(?<Element>[^>\s]+)[^>]*>[^<]*?[^><\/\s][^<]*?<\/\k<Element>>|<script[^>]*>[\s]*<\/script>|<([\w:\._-]+)([^>]*)><\/\2>|<([\w:\._-]+)([^>]*)>[\s]+<\/\4>/g,(match=>match.includes(constants.SELF_CLOSING_PLACEHOLDER)||match.includes(constants.CONTENT_IGNORE_PLACEHOLDER)?match:match.replace(/\n|\t|\s{2,}/g,""))),content_wrap>0&&(final_html=(html=>{const{constants:constants}=getState();return html.replace(new RegExp(`.*${constants.CONTENT_IGNORE_PLACEHOLDER}[a-z]{2}!.*`,"g"),(match=>match.replace(new RegExp(`${constants.CONTENT_IGNORE_PLACEHOLDER}[a-z]{2}!`,"g"),(match=>match.replace(new RegExp(constants.CONTENT_IGNORE_PLACEHOLDER+"nl!","g"),"\n").replace(new RegExp(constants.CONTENT_IGNORE_PLACEHOLDER+"cr!","g"),"\r").replace(new RegExp(constants.CONTENT_IGNORE_PLACEHOLDER+"ws!","g")," ")))))})(final_html)),tag_wrap>0&&(final_html=(html=>{const{constants:constants}=getState();return html.replace(/<[\w:\-]+([^>]*[^\/])>/g,((match,capture)=>match.replace(capture,(match=>match.replace(new RegExp(constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"nl!","g"),"\n").replace(new RegExp(constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"cr!","g"),"\r").replace(new RegExp(constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"ws!","g")," ")))))})(final_html)),strict&&(final_html=final_html.replace(/\s\/>|\/>/g,">")),final_html.startsWith("\n")&&(final_html=final_html.substring(1)),final_html.endsWith("\n")&&(final_html=final_html.substring(0,final_html.length-1)),final_html};return _exports.default=(html,config)=>{let reinsert_ignored=!1;const{checked_html:checked_html,ignored:ignored}=getState();if(!checked_html&&!isHtml(html))return html;const validated_config=validateConfig(config||{}),ignore=validated_config.ignore.length>0;if(validated_config.trim.length>0&&(html=((html,trim)=>{for(let e=0;e<trim.length;e++){const leading_whitespace=new RegExp(`(<${trim[e]}[^>]*>)\\s+`,"g"),trailing_whitespace=new RegExp(`\\s+(</${trim[e]}>)`,"g");html=html.replace(leading_whitespace,"$1").replace(trailing_whitespace,"$1")}return html})(html,validated_config.trim)),!ignored&&ignore){const{html_with_markers:html_with_markers,extracted_map:extracted_map}=extractIgnoredBlocks(html);html=html_with_markers,ignore_map=extracted_map,reinsert_ignored=!0}return html=((html,config)=>{let reinsert_ignored=!1;const{checked_html:checked_html,ignored:ignored,constants:constants}=getState();if(!checked_html&&!isHtml(html))return html;const ignore=getState().config.ignore.length>0;if(!ignored&&ignore){const{html_with_markers:html_with_markers,extracted_map:extracted_map}=extractIgnoredBlocks(html);html=html_with_markers,ignore_map$1=extracted_map,reinsert_ignored=!0}return html=function(html){let minify=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return html=html.replace(/<\s*textarea[^>]*>((.|\n)*?)<s*\/\s*textarea\s*>/g,((match,capture)=>match.replace(capture,(match=>match.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\n/g,"&#10;").replace(/\r/g,"&#13;").replace(/\s/g,"&nbsp;"))))),minify&&(html=html.replace(/<\s*textarea[^>]*>(.|\n)*?<\s*\/\s*textarea\s*>/g,(match=>match.replace(/\s+/g," ").replace(/\s>/g,">").replace(/>\s/g,">").replace(/\s</g,"<").replace(/<\s/g,"<").replace(/<\/\s/g,"</").replace(/class=["']\s/g,(match=>match.replace(/\s/g,""))).replace(/(class=.*)\s(["'])/g,"$1$2")))),html}(html,!0),html=(html=>html.replace(/<textarea[^>]*>((.|\n)*?)<\/textarea>/g,((match,capture)=>match.replace(capture,(match=>match.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#10;/g,"\n").replace(/&#13;/g,"\r").replace(/&nbsp;/g," ").replace(/\s+/g," "))))))(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=html.replace(/\n|\t/g,"")).replace(/>\s+</g,"><")).replace(/ {2,}/g," ")).replace(/(\S) (<[a-zA-Z][a-zA-Z0-9_:-]*)/g,"$1___MINIFY-PROTECTED-SPACE___$2")).replace(/(<\/[a-zA-Z][a-zA-Z0-9_:-]*>) (\S)/g,"$1___MINIFY-PROTECTED-SPACE___$2")).replace(/ >/g,">")).replace(/ </g,"<")).replace(/> /g,">")).replace(/< /g,"<")).replace(/<\s+\//g,"</")).replace(/<\/\s+/g,"</")).replace(new RegExp("___MINIFY-PROTECTED-SPACE___","g")," ")).replace(/ = /g,"=")).replace(/([a-zA-Z0-9_-]+)=(['"])(.*?)\2/g,((match,attr_name,quote,value)=>`${attr_name}=${quote}${value.trim()}${quote}`))).trim()),reinsert_ignored&&(html=reinsertIgnoredBlocks(html,ignore_map$1)),html})(html=function(html){const{constants:constants}=getState();return html.replace(void_element_regex,(match=>match.replace(/>$/,constants.SELF_CLOSING_PLACEHOLDER)))}(html=(html=>{const{constants:constants}=getState();return html.replace(/<([A-Za-z][A-Za-z0-9]*|[a-z][a-z0-9._]*-[a-z0-9._-]+)((?:\s+[A-Za-z0-9_-]+="[^"]*"|\s*[a-z]*)*)>/g,((match,p1,p2)=>match.replace(p2,(match=>match.replace(/</g,constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"lt!").replace(/>/g,constants.ATTRIBUTE_IGNORE_PLACEHOLDER+"gt!")))))})(html))),(html=>{convert.line=[];let i=-1;html.replace(/(<[^>]+>)|([^<]+)/g,((match,c1,c2)=>(c1?convert.line.push({type:"tag",value:match}):c2&&c2.trim().length>0&&convert.line.push({type:"text",value:match}),i++,`\n[#-# : ${i} : ${match} : #-#]\n`)))})(html),html=(html=>{const{constants:constants}=getState(),escapedIgnoreString=constants.ATTRIBUTE_IGNORE_PLACEHOLDER.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),ltPlaceholderRegex=new RegExp(escapedIgnoreString+"lt!","g"),gtPlaceholderRegex=new RegExp(escapedIgnoreString+"gt!","g");return html.replace(/<([\w:\-]+)([^>]*)>/g,((fullMatch,tagName,attributesCapture)=>`<${tagName}${attributesCapture.replace(ltPlaceholderRegex,"<").replace(gtPlaceholderRegex,">")}>`))})(html=process()),reinsert_ignored&&(html=reinsertIgnoredBlocks(html,ignore_map)),html},_exports.default}));

//# sourceMappingURL=htmlfy-lazy.min.js.map