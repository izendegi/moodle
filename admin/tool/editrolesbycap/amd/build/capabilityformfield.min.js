define("tool_editrolesbycap/capabilityformfield",["exports","core/str","core/templates","core/notification"],(function(_exports,Str,_templates,_notification){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initCapabilityFormField=void 0,Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * AMD module to add filtering to the capability form field type.
   *
   * @module tool_editrolesbycap/capabilityformfield
   * @copyright  2012 The Open University
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(Str),_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};let delayHandle=-1;_exports.initCapabilityFormField=async selectorId=>{const select=document.getElementById(selectorId);if(!select)return;const searchFieldId=selectorId+"capabilitysearch",clearButtonid=selectorId+"capabilityclear",nonematchString=await Str.get_string("nonematch","tool_editrolesbycap"),filterValue=sessionStorage.getItem("captblflt"),context={id:searchFieldId,clearbuttonid:clearButtonid,value:filterValue};_templates.default.renderForPromise("tool_editrolesbycap/filter_field",context).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(select.parentNode,html,js);const noneMessageE=document.createElement("optgroup");noneMessageE.setAttribute("label",nonematchString),noneMessageE.setAttribute("id","id_noneerrormessage"),select.append(noneMessageE),setVisible(noneMessageE,!1);const searchField=document.getElementById(searchFieldId),clearButton=document.getElementById(clearButtonid);searchField.addEventListener("input",change),searchField.filterKey="captblflt",searchField.select=select,clearButton.addEventListener("click",clear),clearButton.filterKey="captblflt",clearButton.select=select,clearButton.searchField=searchField,""!==filterValue&&filter("captblflt",select)})).catch(_notification.exception)};const filter=(filterKey,select)=>{const clearButton=document.getElementById(select.getAttribute("id")+"capabilityclear"),filterText=document.getElementById(select.getAttribute("id")+"capabilitysearch").value.toLowerCase();sessionStorage.setItem(filterKey,filterText),clearButton.disabled=""===filterText;let allHidden=!0;if(select.querySelectorAll("optgroup").forEach((optgroup=>{setVisible(optgroup,!1);const lastGroup=optgroup;optgroup.querySelectorAll("option").forEach((option=>{option.textContent.toLowerCase().indexOf(filterText)>=0?(setVisible(lastGroup,!0),setVisible(option,!0),allHidden=!1):setVisible(option,!1)}))})),allHidden){const noneMessageE=document.getElementById("id_noneerrormessage");setVisible(noneMessageE,!0)}},clear=e=>{e.target.searchField.value="",-1!==delayHandle&&(clearTimeout(delayHandle),delayHandle=-1),filter(e.target.filterKey,e.target.select)},change=e=>{let handle=setTimeout((function(){filter(e.target.filterKey,e.target.select)}),100);-1!==delayHandle&&clearTimeout(delayHandle),delayHandle=handle},setVisible=(element,visible)=>{element.style.display=visible?"block":"none"}}));

//# sourceMappingURL=capabilityformfield.min.js.map