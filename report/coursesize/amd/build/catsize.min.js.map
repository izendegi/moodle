{"version":3,"file":"catsize.min.js","sources":["../src/catsize.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle report_coursesize actions.\n *\n * @copyright  Copyright (c) 2021 Open LMS (https://www.openlms.net)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {get_string} from 'core/str';\nimport {renderPix} from 'core/templates';\nimport {relativeUrl} from 'core/url';\n\nconst Selectors = {\n    catToggle: \".cattoggle\",\n    courseToggle: \".coursetoggle\",\n};\n\nexport const init = (sortorder, sortdir, displaysize, excludebackups) => {\n\n    const expander = (type, id) => {\n        const selector = type == 'cat' ? Selectors.catToggle : Selectors.courseToggle;\n\n        if (document.getElementById(type + id).style.display == 'block') {\n            document.getElementById(type + id).style.display = 'none';\n            get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                renderPix('t/switch_plus', 'core', string).then(function (pix) {\n                    $(selector + '[data-id=' + id + ']').html(pix);\n                });\n            });\n        } else {\n            if (document.getElementById(type + id).innerHTML == '') {\n                if (id != 0) {\n                    get_string('loading', 'core').then(function (string) {\n                        renderPix('i/loading', 'core', string).then(function (pix) {\n                            $(selector + '[data-id=' + id + ']').html(pix);\n                        });\n                    });\n                }\n                $.ajax({\n                    type: 'GET',\n                    url: relativeUrl('/report/coursesize/callback.php'),\n                    data: {\n                        id: id,\n                        course: type == 'cat' ? 0 : 1,\n                        sorder: sortorder,\n                        sdir: sortdir,\n                        display: displaysize,\n                        excludebackups: excludebackups,\n                    },\n                }).done(function (data) {\n                    document.getElementById(type + id).innerHTML = data;\n                    document.getElementById(type + id).style.display = 'block';\n                    if (id != 0) {\n                        get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                            renderPix('t/switch_minus', 'core', string).then(function (pix) {\n                                $(selector + '[data-id=' + id + ']').html(pix);\n                            });\n                        });\n                    }\n                });\n            } else {\n                document.getElementById(type + id).style.display = 'block';\n                if (id != 0) {\n                    get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                        renderPix('t/switch_minus', 'core', string).then(function (pix) {\n                            $(selector + '[data-id=' + id + ']').html(pix);\n                        });\n                    });\n                }\n            }\n        }\n    };\n\n    const registerEventListeners = () => {\n        document.addEventListener('click', e => {\n            var target = e.target;\n            if ($(target).attr('data-id') === undefined) {\n                target = e.target.parentNode;\n            }\n            if (e.target.closest(Selectors.catToggle)) {\n                e.preventDefault();\n                expander('cat', target.getAttribute('data-id'));\n                return;\n            }\n            if (e.target.closest(Selectors.courseToggle)) {\n                e.preventDefault();\n                expander('course', target.getAttribute('data-id'));\n                return;\n            }\n        });\n    };\n\n    expander('cat', 0);\n    registerEventListeners();\n};\n"],"names":["Selectors","sortorder","sortdir","displaysize","excludebackups","expander","type","id","selector","document","getElementById","style","display","then","string","pix","html","innerHTML","ajax","url","data","course","sorder","sdir","done","addEventListener","e","target","undefined","attr","parentNode","closest","preventDefault","getAttribute"],"mappings":";;;;;;gJA2BMA,oBACS,aADTA,uBAEY,8BAGE,CAACC,UAAWC,QAASC,YAAaC,wBAE5CC,SAAW,CAACC,KAAMC,YACdC,SAAmB,OAARF,KAAgBN,oBAAsBA,uBAEC,SAApDS,SAASC,eAAeJ,KAAOC,IAAII,MAAMC,SACzCH,SAASC,eAAeJ,KAAOC,IAAII,MAAMC,QAAU,2BACxC,WAAY,qBAAqBC,MAAK,SAAUC,iCAC7C,gBAAiB,OAAQA,QAAQD,MAAK,SAAUE,yBACpDP,SAAW,YAAcD,GAAK,KAAKS,KAAKD,YAIE,IAAhDN,SAASC,eAAeJ,KAAOC,IAAIU,WACzB,GAANV,wBACW,UAAW,QAAQM,MAAK,SAAUC,iCAC/B,YAAa,OAAQA,QAAQD,MAAK,SAAUE,yBAChDP,SAAW,YAAcD,GAAK,KAAKS,KAAKD,2BAIpDG,KAAK,CACHZ,KAAM,MACNa,KAAK,oBAAY,mCACjBC,KAAM,CACFb,GAAIA,GACJc,OAAgB,OAARf,KAAgB,EAAI,EAC5BgB,OAAQrB,UACRsB,KAAMrB,QACNU,QAAST,YACTC,eAAgBA,kBAErBoB,MAAK,SAAUJ,MACdX,SAASC,eAAeJ,KAAOC,IAAIU,UAAYG,KAC/CX,SAASC,eAAeJ,KAAOC,IAAII,MAAMC,QAAU,QACzC,GAANL,wBACW,WAAY,qBAAqBM,MAAK,SAAUC,iCAC7C,iBAAkB,OAAQA,QAAQD,MAAK,SAAUE,yBACrDP,SAAW,YAAcD,GAAK,KAAKS,KAAKD,gBAM1DN,SAASC,eAAeJ,KAAOC,IAAII,MAAMC,QAAU,QACzC,GAANL,wBACW,WAAY,qBAAqBM,MAAK,SAAUC,iCAC7C,iBAAkB,OAAQA,QAAQD,MAAK,SAAUE,yBACrDP,SAAW,YAAcD,GAAK,KAAKS,KAAKD,aA2BlEV,SAAS,MAAO,GAlBZI,SAASgB,iBAAiB,SAASC,QAC3BC,OAASD,EAAEC,mBACmBC,KAA9B,mBAAED,QAAQE,KAAK,aACfF,OAASD,EAAEC,OAAOG,YAElBJ,EAAEC,OAAOI,QAAQ/B,sBACjB0B,EAAEM,sBACF3B,SAAS,MAAOsB,OAAOM,aAAa,aAGpCP,EAAEC,OAAOI,QAAQ/B,yBACjB0B,EAAEM,sBACF3B,SAAS,SAAUsB,OAAOM,aAAa"}