{"version":3,"file":"create_attempt_dialog.min.js","sources":["../src/create_attempt_dialog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the create_attempt_dialog class.\n *\n * @module    quiz_answersheets/create_attempt_dialog\n * @copyright  2019 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_events', 'core/ajax', 'core/notification', 'core/modal_save_cancel'],\n    function($, ModalEvents, Ajax, Notification, ModalSaveCancel) {\n        var t = {\n            SELECTOR: '.create-attempt-btn',\n            init: function() {\n                $(t.SELECTOR).click(function(e) {\n                    e.preventDefault();\n                    var target = $(this).closest('table').find('button');\n                    t.disableButton(target, true);\n                    var message = $(this).data('message');\n                    var params = {\n                        quizid: $(this).data('quiz-id'),\n                        userid: $(this).data('user-id'),\n                        url: $(this).data('url')\n                    };\n                    ModalSaveCancel.create({\n                        title: M.util.get_string('create_attempt_modal_title', 'quiz_answersheets'),\n                        body: message,\n                        buttons: {\n                            save: M.util.get_string('create_attempt_modal_button', 'quiz_answersheets'),\n                        },\n                        show: true,\n                    }).then((modal) => {\n                        modal.getRoot().on(ModalEvents.save, params, t.createAttempt);\n                        modal.show();\n                        // Handle hidden event.\n                        modal.getRoot().on(ModalEvents.hidden, modal, t.closeModal);\n                        return modal;\n                    }).catch(function(err) {\n                        t.exceptionHandler(err, target);\n                    });\n                });\n            },\n            closeModal: function(e) {\n                var modal = e.data;\n                var target = $(t.SELECTOR).closest('table').find('button');\n                modal.destroy();\n                t.disableButton(target, false);\n            },\n            createAttempt: function(e) {\n                e.preventDefault();\n                var data = e.data;\n                var modalButtons = $(e.target).find('button');\n                t.disableButton(modalButtons, true);\n                var promises = Ajax.call([{\n                    methodname: 'quiz_answersheets_create_attempt',\n                    args: {\n                        quizid: data.quizid,\n                        userid: data.userid\n                    }\n                }]);\n                // Handle promise.\n                promises[0].then(function(res) {\n                    var id = res.id || '';\n                    window.location.href = t.updateQueryStringParameter(data.url, 'lastchanged', id);\n                    return true;\n                }).fail(function(err) {\n                    t.exceptionHandler(err, modalButtons);\n                });\n            },\n            disableButton: function(el, status) {\n                el.prop(\"disabled\", status);\n            },\n            exceptionHandler: function(ex, el) {\n                Notification.exception(ex);\n                t.disableButton(el, false);\n            },\n            updateQueryStringParameter: function(uri, key, value) {\n                var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n                var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n                if (uri.match(re)) {\n                    return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n                } else {\n                    return uri + separator + key + \"=\" + value;\n                }\n            }\n        };\n        return t;\n    });\n"],"names":["define","$","ModalEvents","Ajax","Notification","ModalSaveCancel","t","SELECTOR","init","click","e","preventDefault","target","this","closest","find","disableButton","message","data","params","quizid","userid","url","create","title","M","util","get_string","body","buttons","save","show","then","modal","getRoot","on","createAttempt","hidden","closeModal","catch","err","exceptionHandler","destroy","modalButtons","call","methodname","args","res","id","window","location","href","updateQueryStringParameter","fail","el","status","prop","ex","exception","uri","key","value","re","RegExp","separator","indexOf","match","replace"],"mappings":";;;;;;;AAsBAA,iDAAO,CAAC,SAAU,oBAAqB,YAAa,oBAAqB,2BACrE,SAASC,EAAGC,YAAaC,KAAMC,aAAcC,qBACrCC,EAAI,CACJC,SAAU,sBACVC,KAAM,WACFP,EAAEK,EAAEC,UAAUE,OAAM,SAASC,GACzBA,EAAEC,qBACEC,OAASX,EAAEY,MAAMC,QAAQ,SAASC,KAAK,UAC3CT,EAAEU,cAAcJ,QAAQ,OACpBK,QAAUhB,EAAEY,MAAMK,KAAK,WACvBC,OAAS,CACTC,OAAQnB,EAAEY,MAAMK,KAAK,WACrBG,OAAQpB,EAAEY,MAAMK,KAAK,WACrBI,IAAKrB,EAAEY,MAAMK,KAAK,QAEtBb,gBAAgBkB,OAAO,CACnBC,MAAOC,EAAEC,KAAKC,WAAW,6BAA8B,qBACvDC,KAAMX,QACNY,QAAS,CACLC,KAAML,EAAEC,KAAKC,WAAW,8BAA+B,sBAE3DI,MAAM,IACPC,MAAMC,QACLA,MAAMC,UAAUC,GAAGjC,YAAY4B,KAAMX,OAAQb,EAAE8B,eAC/CH,MAAMF,OAENE,MAAMC,UAAUC,GAAGjC,YAAYmC,OAAQJ,MAAO3B,EAAEgC,YACzCL,SACRM,OAAM,SAASC,KACdlC,EAAEmC,iBAAiBD,IAAK5B,eAIpC0B,WAAY,SAAS5B,OACbuB,MAAQvB,EAAEQ,KACVN,OAASX,EAAEK,EAAEC,UAAUO,QAAQ,SAASC,KAAK,UACjDkB,MAAMS,UACNpC,EAAEU,cAAcJ,QAAQ,IAE5BwB,cAAe,SAAS1B,GACpBA,EAAEC,qBACEO,KAAOR,EAAEQ,KACTyB,aAAe1C,EAAES,EAAEE,QAAQG,KAAK,UACpCT,EAAEU,cAAc2B,cAAc,GACfxC,KAAKyC,KAAK,CAAC,CACtBC,WAAY,mCACZC,KAAM,CACF1B,OAAQF,KAAKE,OACbC,OAAQH,KAAKG,WAIZ,GAAGW,MAAK,SAASe,SAClBC,GAAKD,IAAIC,IAAM,UACnBC,OAAOC,SAASC,KAAO7C,EAAE8C,2BAA2BlC,KAAKI,IAAK,cAAe0B,KACtE,KACRK,MAAK,SAASb,KACblC,EAAEmC,iBAAiBD,IAAKG,kBAGhC3B,cAAe,SAASsC,GAAIC,QACxBD,GAAGE,KAAK,WAAYD,SAExBd,iBAAkB,SAASgB,GAAIH,IAC3BlD,aAAasD,UAAUD,IACvBnD,EAAEU,cAAcsC,IAAI,IAExBF,2BAA4B,SAASO,IAAKC,IAAKC,WACvCC,GAAK,IAAIC,OAAO,SAAWH,IAAM,YAAa,KAC9CI,WAAkC,IAAtBL,IAAIM,QAAQ,KAAc,IAAM,WAC5CN,IAAIO,MAAMJ,IACHH,IAAIQ,QAAQL,GAAI,KAAOF,IAAM,IAAMC,MAAQ,MAE3CF,IAAMK,UAAYJ,IAAM,IAAMC,eAI1CvD"}