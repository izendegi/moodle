"use strict";(function(root,factory){if(typeof define==="function"&&define.amd){define("pdfjs-web/mozPrintCallback_polyfill",["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.pdfjsWebMozPrintCallbackPolyfill={})}})(this,function(exports){if("mozPrintCallback"in document.createElement("canvas")){return}HTMLCanvasElement.prototype.mozPrintCallback=undefined;var canvases;var index;var print=window.print;window.print=function print(){if(canvases){console.warn("Ignored window.print() because of a pending print job.");return}try{dispatchEvent("beforeprint")}finally{canvases=document.querySelectorAll("canvas");index=-1;next()}};function dispatchEvent(eventType){var event=document.createEvent("CustomEvent");event.initCustomEvent(eventType,false,false,"custom");window.dispatchEvent(event)}function next(){if(!canvases){return}renderProgress();if(++index<canvases.length){var canvas=canvases[index];if(typeof canvas.mozPrintCallback==="function"){canvas.mozPrintCallback({context:canvas.getContext("2d"),abort:abort,done:next})}else{next()}}else{renderProgress();print.call(window);setTimeout(abort,20)}}function abort(){if(canvases){canvases=null;renderProgress();dispatchEvent("afterprint")}}function renderProgress(){var progressContainer=document.getElementById("mozPrintCallback-shim");if(canvases&&canvases.length){var progress=Math.round(100*index/canvases.length);var progressBar=progressContainer.querySelector("progress");var progressPerc=progressContainer.querySelector(".relative-progress");progressBar.value=progress;progressPerc.textContent=progress+"%";progressContainer.removeAttribute("hidden");progressContainer.onclick=abort}else{progressContainer.setAttribute("hidden","")}}var hasAttachEvent=!!document.attachEvent;window.addEventListener("keydown",function(event){if(event.keyCode===80&&(event.ctrlKey||event.metaKey)&&!event.altKey&&(!event.shiftKey||window.chrome||window.opera)){window.print();if(hasAttachEvent){return}event.preventDefault();if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.stopPropagation()}return}if(event.keyCode===27&&canvases){abort()}},true);if(hasAttachEvent){document.attachEvent("onkeydown",function(event){event=event||window.event;if(event.keyCode===80&&event.ctrlKey){event.keyCode=0;return false}})}if("onbeforeprint"in window){var stopPropagationIfNeeded=function(event){if(event.detail!=="custom"&&event.stopImmediatePropagation){event.stopImmediatePropagation()}};window.addEventListener("beforeprint",stopPropagationIfNeeded,false);window.addEventListener("afterprint",stopPropagationIfNeeded,false)}});